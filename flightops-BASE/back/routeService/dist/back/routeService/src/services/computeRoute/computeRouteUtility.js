'use strict';const a7_0x515b4a=a7_0x278b;(function(_0x16292f,_0x1bec99){const _0x39ac53=a7_0x278b,_0x271b40=_0x16292f();while(!![]){try{const _0x272278=-parseInt(_0x39ac53(0x18e))/0x1*(-parseInt(_0x39ac53(0x18f))/0x2)+parseInt(_0x39ac53(0x17a))/0x3*(parseInt(_0x39ac53(0x173))/0x4)+parseInt(_0x39ac53(0x164))/0x5*(-parseInt(_0x39ac53(0x162))/0x6)+parseInt(_0x39ac53(0x163))/0x7+-parseInt(_0x39ac53(0x154))/0x8+-parseInt(_0x39ac53(0x146))/0x9+-parseInt(_0x39ac53(0x18d))/0xa;if(_0x272278===_0x1bec99)break;else _0x271b40['push'](_0x271b40['shift']());}catch(_0x542bdb){_0x271b40['push'](_0x271b40['shift']());}}}(a7_0x5c0b,0x5d81d));function a7_0x278b(_0x90a15c,_0x5ee23c){const _0x5c0b67=a7_0x5c0b();return a7_0x278b=function(_0x278b79,_0x4356af){_0x278b79=_0x278b79-0x141;let _0x2cae21=_0x5c0b67[_0x278b79];return _0x2cae21;},a7_0x278b(_0x90a15c,_0x5ee23c);}Object[a7_0x515b4a(0x16e)](exports,a7_0x515b4a(0x157),{'value':!![]}),exports[a7_0x515b4a(0x16f)]=void 0x0;function a7_0x5c0b(){const _0x36a699=['ASL_Max','splice','heightRange','cellSize','instance','../../../../../classes/applicationClasses/utility/matrixUtility','now','isPOINT','computeRoutePromise','lodash','calcDistance','isAGL','../../../../../classes/applicationClasses/utility/geoCalc','10039540NjUvtN','341893TzBVzo','4xzNMHJ','convertRouteToCartographic','../../../../../classes/applicationClasses/utility/geoUtility','SiteManager','simplifyPath_3D_newLogic','matrixPoints:\x20','calcDestination','length','computeRoute','isFinite','can\x20not\x20build\x20the\x20path:\x20','712431ZxzYpc','maxLegLength','grid','computeRouteUtility,\x20simplifyPath:\x20','convertToShirtLags','isPOINTsArray','./../../../../../../../../config/services.json','getPartOfSiteWithGenerateGrid_filtered','trunc','GeoCalc','fromTo','getSiteWithGenerateGrid','min','\x20-\x20computeRoute\x20-\x20','547040OMovZe','getMatrix','\x20-\x20computeDirectionRoute\x20-\x20','__esModule','POINTS:','stringify','round','-\x20ComputeRouteUtility\x20-',';\x20path:\x20','direction','northWest','../matrix/matrixManager','../site/siteManager','MatrixManager','23394TRqyGY','4787461eEROMH','145tNapVv','log','allowedId','defaultLastLegLength','*caltch*','GeoUtility','push','computeNewPointsForShirtLeg','computeDirectionRoute_floating','MatrixUtility','defineProperty','ComputeRouteUtility','cloneDeep','checkIsNotCrossNfzMatrix_3D','Logger','8SvLJjM','lastLegLength','\x20allowedId:\x20','cartographicToMatrix','../../logger/Logger','logStatus','computeDirectionRoute','419790SnTJji','routeService','computeCompressPath','altitudeRange','height','defaultMaxLegLength'];a7_0x5c0b=function(){return _0x36a699;};return a7_0x5c0b();}const _=require(a7_0x515b4a(0x189)),geoUtility_1=require(a7_0x515b4a(0x191)),geoCalc_1=require(a7_0x515b4a(0x18c)),siteManager_1=require(a7_0x515b4a(0x160)),matrixUtility_1=require(a7_0x515b4a(0x185)),Logger_1=require(a7_0x515b4a(0x177)),matrixManager_1=require(a7_0x515b4a(0x15f)),servicesConf=require(a7_0x515b4a(0x14c)),routeComputeConfig=require('./../../../../../../../../config/routeComputeConfig.json'),defaultMaxLegLength=servicesConf[a7_0x515b4a(0x17b)][a7_0x515b4a(0x17f)],defaultLastLegLength=servicesConf[a7_0x515b4a(0x17b)][a7_0x515b4a(0x167)],heightRange=routeComputeConfig[a7_0x515b4a(0x182)],heightFactor=routeComputeConfig['heightFactor'];class ComputeRouteUtility{constructor(){const _0x283137=a7_0x515b4a;this[_0x283137(0x143)]=(_0xc7b369,_0x504172)=>{const _0x72ed9f=_0x283137;let _0x1f72fc={'id':_0xc7b369['allowedId'],'route':[]},_0x2a01d4=[];try{if(_0xc7b369&&_0xc7b369[_0x72ed9f(0x17d)]){const _0x2cf4dd=siteManager_1['SiteManager'][_0x72ed9f(0x14d)](_0xc7b369,_0x504172),_0x156e1c={'cellSize':_0x2cf4dd['cellSize'],'northWest':_0x2cf4dd['northWestCropped']},_0x1498dc=this[_0x72ed9f(0x176)](_0x156e1c,_0xc7b369[_0x72ed9f(0x150)]);if(_0x1498dc){const _0xe2150d=matrixManager_1[_0x72ed9f(0x161)][_0x72ed9f(0x17c)](_0x1498dc,_0x2cf4dd[_0x72ed9f(0x148)]),_0x261029=matrixUtility_1[_0x72ed9f(0x16d)]['pathToRelativeBase'](_0xe2150d,_0x2cf4dd['matrixFactor']),_0x3474af=siteManager_1[_0x72ed9f(0x192)][_0x72ed9f(0x155)](_0xc7b369[_0x72ed9f(0x166)]),_0x1f6c8b=this[_0x72ed9f(0x193)](_0x3474af,_0x261029,_0xc7b369,_0x504172);_0x2a01d4=this[_0x72ed9f(0x190)](_0x2cf4dd,_0x1f6c8b,_0xc7b369[_0x72ed9f(0x150)]),this[_0x72ed9f(0x14a)](_0x2a01d4,_0xc7b369[_0x72ed9f(0x147)]||defaultMaxLegLength),_0x1f72fc={'route':_0x2a01d4,'id':_0xc7b369[_0x72ed9f(0x166)]};}else _0x1f72fc={'route':[],'id':_0xc7b369[_0x72ed9f(0x166)]},this[_0x72ed9f(0x178)](_0x72ed9f(0x153)+_0x72ed9f(0x168)+_0x72ed9f(0x194)+JSON[_0x72ed9f(0x159)](_0x1498dc,undefined,0x2)+JSON[_0x72ed9f(0x159)](_0xc7b369,undefined,0x2)+_0x72ed9f(0x15c)+JSON['stringify'](_0x2a01d4,undefined,0x2)+_0x72ed9f(0x175)+_0xc7b369['allowedId']);}else this[_0x72ed9f(0x178)]('\x20-\x20computeRoute\x20-\x20'+_0x72ed9f(0x168)+'pointsForRoute:\x20'+JSON['stringify'](_0xc7b369,undefined,0x2)+JSON[_0x72ed9f(0x159)](_0xc7b369,undefined,0x2)+';\x20path:\x20'+JSON[_0x72ed9f(0x159)](_0x2a01d4,undefined,0x2)+_0x72ed9f(0x175)+_0xc7b369[_0x72ed9f(0x166)]);}catch(_0x3932c9){console[_0x72ed9f(0x165)](_0x72ed9f(0x145),JSON[_0x72ed9f(0x159)](_0x3932c9)),console[_0x72ed9f(0x165)](_0x72ed9f(0x158),_0xc7b369),this[_0x72ed9f(0x178)]('\x20-\x20computeDirectionRoute\x20-\x20'+_0x72ed9f(0x168)+JSON['stringify'](_0x3932c9,undefined,0x2)+JSON['stringify'](_0xc7b369,undefined,0x2)+_0x72ed9f(0x15c)+JSON['stringify'](_0x2a01d4,undefined,0x2)+_0x72ed9f(0x175)+_0xc7b369[_0x72ed9f(0x166)]),_0x1f72fc={'route':[],'id':_0xc7b369['allowedId']};}return _0x1f72fc;},this[_0x283137(0x188)]=(_0x15ae31,_0xaae568)=>{return new Promise((_0x17729b,_0x59a26d)=>{const _0x998dc8=this['computeRoute'](_0x15ae31,_0xaae568);_0x17729b({'success':!![],'data':_0x998dc8});});},this[_0x283137(0x179)]=_0x497f2f=>{const _0x4bca76=_0x283137;let _0x1af6dc,_0x4fcf24=[];const _0x1ca070=siteManager_1[_0x4bca76(0x192)][_0x4bca76(0x151)](_0x497f2f[_0x4bca76(0x166)],_0x497f2f['altitudeRange'][_0x4bca76(0x152)]);if(geoUtility_1[_0x4bca76(0x169)]['isCartographicPOINTsArray'](_0x497f2f[_0x4bca76(0x150)])&&_0x497f2f[_0x4bca76(0x150)][_0x4bca76(0x142)]>=0x2&&Number[_0x4bca76(0x144)](_0x497f2f['direction'])){const _0x4822b8=Number[_0x4bca76(0x144)](_0x497f2f['lastLegLength'])?_0x497f2f[_0x4bca76(0x174)]:defaultLastLegLength,_0x53732d=geoCalc_1[_0x4bca76(0x14f)][_0x4bca76(0x141)](_0x497f2f['fromTo'][0x1],-_0x4822b8,_0x497f2f[_0x4bca76(0x15d)]),_0x425697=siteManager_1['SiteManager'][_0x4bca76(0x155)](_0x497f2f['allowedId']),_0x26b392=this[_0x4bca76(0x176)](_0x1ca070,[_0x53732d,_0x497f2f[_0x4bca76(0x150)][0x1]]),_0x518b16=matrixUtility_1[_0x4bca76(0x16d)][_0x4bca76(0x171)](_0x26b392,_0x425697,[_0x497f2f['altitudeRange'][_0x4bca76(0x152)],_0x497f2f[_0x4bca76(0x17d)]['min']]);if(_0x518b16){const _0xae96ff=this['cartographicToMatrix'](_0x1ca070,[_0x497f2f[_0x4bca76(0x150)][0x0],_0x53732d]);try{if(_0xae96ff){const _0x25744b=matrixManager_1[_0x4bca76(0x161)][_0x4bca76(0x17c)](_0xae96ff,_[_0x4bca76(0x170)](_0x1ca070['grid'])),_0x37f2fb=this['simplifyPath_3D_newLogic'](_0x425697,_0x25744b,_0x497f2f);_0x4fcf24=this[_0x4bca76(0x190)](_0x1ca070,_0x37f2fb,[_0x497f2f['fromTo'][0x0],_0x53732d]),_0x4fcf24['push'](_0x497f2f[_0x4bca76(0x150)][0x1]),this['convertToShirtLags'](_0x4fcf24,_0x497f2f[_0x4bca76(0x147)]||defaultMaxLegLength),_0x1af6dc={'route':_0x4fcf24,'id':_0x497f2f[_0x4bca76(0x166)]};}else _0x1af6dc={'route':[],'id':_0x497f2f['allowedId']},this['logStatus'](_0x4bca76(0x156)+_0x4bca76(0x168)+'matrixPoints:\x20'+JSON[_0x4bca76(0x159)](_0xae96ff,undefined,0x2)+JSON[_0x4bca76(0x159)](_0x497f2f,undefined,0x2)+_0x4bca76(0x15c)+JSON[_0x4bca76(0x159)](_0x4fcf24,undefined,0x2)+_0x4bca76(0x175)+_0x497f2f[_0x4bca76(0x166)]);}catch(_0x430a80){console['log']('can\x20not\x20build\x20the\x20path:\x20',JSON[_0x4bca76(0x159)](_0x430a80)),this[_0x4bca76(0x178)](_0x4bca76(0x156)+_0x4bca76(0x168)+JSON['stringify'](_0x430a80,undefined,0x2)+JSON[_0x4bca76(0x159)](_0x497f2f,undefined,0x2)+_0x4bca76(0x15c)+JSON['stringify'](_0x4fcf24,undefined,0x2)+_0x4bca76(0x175)+_0x497f2f[_0x4bca76(0x166)]),_0x1af6dc={'route':[],'id':_0x497f2f[_0x4bca76(0x166)]};}}}return _0x1af6dc;},this[_0x283137(0x16c)]=_0xd30661=>{const _0x45f2f8=_0x283137;let _0xa2daf0,_0x5517c4=[];const _0xa7dcb2=siteManager_1[_0x45f2f8(0x192)][_0x45f2f8(0x151)](_0xd30661[_0x45f2f8(0x166)],_0xd30661[_0x45f2f8(0x17d)]['min']);if(geoUtility_1[_0x45f2f8(0x169)]['isCartographicPOINTsArray'](_0xd30661[_0x45f2f8(0x150)])&&_0xd30661[_0x45f2f8(0x150)]['length']>=0x2&&Number[_0x45f2f8(0x144)](_0xd30661['direction'])){const _0x5a925e=Number[_0x45f2f8(0x144)](_0xd30661[_0x45f2f8(0x174)])?_0xd30661[_0x45f2f8(0x174)]:defaultLastLegLength,_0x167578=geoCalc_1['GeoCalc'][_0x45f2f8(0x141)](_0xd30661[_0x45f2f8(0x150)][0x1],-_0x5a925e,_0xd30661['direction']),_0x2ffdee=siteManager_1[_0x45f2f8(0x192)][_0x45f2f8(0x155)](_0xd30661[_0x45f2f8(0x166)]),_0x35c459=this[_0x45f2f8(0x176)](_0xa7dcb2,[_0x167578,_0xd30661[_0x45f2f8(0x150)][0x1]]),_0xfac48d=matrixUtility_1[_0x45f2f8(0x16d)][_0x45f2f8(0x171)](_0x35c459,_0x2ffdee,[_0xd30661[_0x45f2f8(0x17d)]['min'],_0xd30661[_0x45f2f8(0x17d)][_0x45f2f8(0x152)]]);if(_0xfac48d){const _0x3bc4e6=this[_0x45f2f8(0x176)](_0xa7dcb2,[_0xd30661[_0x45f2f8(0x150)][0x0],_0x167578]);try{if(_0x3bc4e6){const _0x32fe49=matrixManager_1['MatrixManager'][_0x45f2f8(0x17c)](_0x3bc4e6,_[_0x45f2f8(0x170)](_0xa7dcb2[_0x45f2f8(0x148)])),_0x42de69=this[_0x45f2f8(0x193)](_0x2ffdee,_0x32fe49,_0xd30661);_0x5517c4=this[_0x45f2f8(0x190)](_0xa7dcb2,_0x42de69,[_0xd30661[_0x45f2f8(0x150)][0x0],_0x167578]),_0x5517c4[_0x45f2f8(0x16a)](_0xd30661[_0x45f2f8(0x150)][0x1]),this[_0x45f2f8(0x14a)](_0x5517c4,_0xd30661[_0x45f2f8(0x147)]||defaultMaxLegLength),_0xa2daf0={'route':_0x5517c4,'id':_0xd30661[_0x45f2f8(0x166)]};}else _0xa2daf0={'route':[],'id':_0xd30661['allowedId']},this[_0x45f2f8(0x178)]('\x20-\x20computeDirectionRoute\x20-\x20'+'*caltch*'+_0x45f2f8(0x194)+JSON[_0x45f2f8(0x159)](_0x3bc4e6,undefined,0x2)+JSON[_0x45f2f8(0x159)](_0xd30661,undefined,0x2)+';\x20path:\x20'+JSON[_0x45f2f8(0x159)](_0x5517c4,undefined,0x2)+'\x20allowedId:\x20'+_0xd30661[_0x45f2f8(0x166)]);}catch(_0x17a663){console['log']('can\x20not\x20build\x20the\x20path:\x20',JSON[_0x45f2f8(0x159)](_0x17a663)),this[_0x45f2f8(0x178)](_0x45f2f8(0x156)+_0x45f2f8(0x168)+JSON[_0x45f2f8(0x159)](_0x17a663,undefined,0x2)+JSON[_0x45f2f8(0x159)](_0xd30661,undefined,0x2)+';\x20path:\x20'+JSON[_0x45f2f8(0x159)](_0x5517c4,undefined,0x2)+'\x20allowedId:\x20'+_0xd30661[_0x45f2f8(0x166)]),_0xa2daf0={'route':[],'id':_0xd30661[_0x45f2f8(0x166)]};}}}return _0xa2daf0;},this[_0x283137(0x14a)]=(_0x4f8fc5,_0x30761e)=>{const _0x2fbfaa=_0x283137;if(geoUtility_1[_0x2fbfaa(0x169)][_0x2fbfaa(0x14b)](_0x4f8fc5))for(let _0x2877fc=0x0;_0x2877fc<_0x4f8fc5[_0x2fbfaa(0x142)]-0x1;_0x2877fc++){const _0x5e4fbf=_0x4f8fc5[_0x2877fc],_0x48640e=_0x4f8fc5[_0x2877fc+0x1],_0x49b8a5=geoCalc_1['GeoCalc'][_0x2fbfaa(0x18a)](_0x5e4fbf,_0x48640e);if(_0x49b8a5>_0x30761e){const _0xe02334=this[_0x2fbfaa(0x16b)](_0x49b8a5,_0x5e4fbf,_0x48640e,_0x30761e);_0x4f8fc5['splice'](_0x2877fc+0x1,0x0,..._0xe02334),_0x2877fc+=_0xe02334['length'];}}},this[_0x283137(0x16b)]=(_0x43da2e,_0x3526c2,_0x5ca166,_0x5266a7)=>{const _0x2b6fe3=_0x283137,_0x5772ea=[],_0x4948b4=Math[_0x2b6fe3(0x15a)](_0x43da2e/_0x5266a7)+0x1,_0x578b8c=_0x43da2e/_0x4948b4;for(let _0x5be463=0x1;_0x5be463<_0x4948b4;_0x5be463++){const _0x57dfcd=_0x578b8c*_0x5be463,_0x3ff5f2=geoCalc_1['GeoCalc']['along']([_0x3526c2,_0x5ca166],_0x57dfcd);_0x3ff5f2&&_0x5772ea[_0x2b6fe3(0x16a)](_0x3ff5f2);}return _0x5772ea;},this[_0x283137(0x193)]=(_0x19af0d,_0x392d89,_0x395499,_0x5c66b9)=>{const _0xc0ca77=_0x283137,_0x3d6a10=Date[_0xc0ca77(0x186)]();let _0x18fcbf=_0x5c66b9!==undefined?_0x5c66b9:_0x395499[_0xc0ca77(0x17e)];_0x395499[_0xc0ca77(0x18b)]?_0x395499['altitudeRange']&&(_0x18fcbf=_0x395499[_0xc0ca77(0x180)]-_0x395499[_0xc0ca77(0x17d)]['min']):_0x18fcbf=_0x5c66b9!==undefined?_0x5c66b9:_0x395499[_0xc0ca77(0x17d)][_0xc0ca77(0x152)];_0x18fcbf===undefined&&(_0x18fcbf=heightRange['min']+0x1);_0x18fcbf-=heightFactor;for(let _0x55a5b4=0x0;_0x55a5b4<_0x392d89['length']-0x2;_0x55a5b4++){for(let _0x2395fe=_0x392d89[_0xc0ca77(0x142)]-0x1;_0x2395fe>_0x55a5b4+0x1;_0x2395fe--){const _0x4bcd4e=[_0x392d89[_0x55a5b4],_0x392d89[_0x2395fe]],_0x339f60=_0x19af0d;try{const _0x25819e=matrixUtility_1['MatrixUtility']['checkIsNotCrossNfzMatrix_3D'](_0x4bcd4e,_0x339f60,[_0x18fcbf,_0x18fcbf],!![]);if(_0x25819e)_0x392d89[_0xc0ca77(0x181)](_0x55a5b4+0x1,_0x2395fe-_0x55a5b4-0x1),_0x2395fe=_0x55a5b4,_0x55a5b4--;else{}}catch(_0x17ea7e){console[_0xc0ca77(0x165)](_0xc0ca77(0x149),JSON[_0xc0ca77(0x159)](_0x17ea7e));}}}return _0x392d89;},this[_0x283137(0x176)]=(_0x474cb6,_0x20e752)=>{const _0x467f87=_0x283137,_0xa80559=Date['now'](),_0x476747=[],_0xaa7b57=_0x474cb6[_0x467f87(0x15e)],_0x1ab004=_0x474cb6[_0x467f87(0x183)];return geoUtility_1['GeoUtility'][_0x467f87(0x187)](_0x1ab004)&&geoUtility_1['GeoUtility']['isCartographicPOINTsArray'](_0x20e752)&&_0x20e752['forEach'](_0x40332e=>{const _0x203adb=_0x467f87;_0x476747[_0x203adb(0x16a)]([Math[_0x203adb(0x14e)]((_0x40332e[0x0]-_0xaa7b57[0x0])/_0x1ab004[0x0]),Math[_0x203adb(0x14e)]((_0xaa7b57[0x1]-_0x40332e[0x1])/_0x1ab004[0x1])]);}),_0x476747;},this[_0x283137(0x190)]=(_0xebb812,_0x4adec0,_0x1c4d1e)=>{const _0x4b5c78=_0x283137;let _0x54943c=[];if(geoUtility_1[_0x4b5c78(0x169)][_0x4b5c78(0x14b)](_0x4adec0)){_0x54943c=[_0x1c4d1e[0x0]];const _0x4183dc=_0xebb812[_0x4b5c78(0x183)],_0x3d67e9=[_0xebb812['northWest'][0x0]+_0x4183dc[0x0]/0x2,_0xebb812[_0x4b5c78(0x15e)][0x1]-_0x4183dc[0x1]/0x2];if(geoUtility_1['GeoUtility'][_0x4b5c78(0x187)](_0x3d67e9)&&_0x3d67e9[_0x4b5c78(0x142)]===0x2&&geoUtility_1[_0x4b5c78(0x169)][_0x4b5c78(0x187)](_0x4183dc)&&_0x4183dc[_0x4b5c78(0x142)]===0x2)for(let _0x36cff4=0x1;_0x36cff4<_0x4adec0[_0x4b5c78(0x142)]-0x1;_0x36cff4++){_0x54943c[_0x4b5c78(0x16a)]([_0x3d67e9[0x0]+_0x4adec0[_0x36cff4][0x0]*_0x4183dc[0x0],_0x3d67e9[0x1]-_0x4adec0[_0x36cff4][0x1]*_0x4183dc[0x1]]);}_0x54943c['push'](_0x1c4d1e[0x1]);}return _0x54943c;},this[_0x283137(0x178)]=_0x104b02=>{const _0xb518fa=_0x283137;Logger_1[_0xb518fa(0x172)]['info'](_0xb518fa(0x15b),_0x104b02);};}}exports[a7_0x515b4a(0x16f)]=ComputeRouteUtility,ComputeRouteUtility['instance']=new ComputeRouteUtility(),ComputeRouteUtility[a7_0x515b4a(0x143)]=ComputeRouteUtility[a7_0x515b4a(0x184)][a7_0x515b4a(0x143)],ComputeRouteUtility[a7_0x515b4a(0x188)]=ComputeRouteUtility[a7_0x515b4a(0x184)][a7_0x515b4a(0x188)],ComputeRouteUtility[a7_0x515b4a(0x179)]=ComputeRouteUtility['instance'][a7_0x515b4a(0x179)],ComputeRouteUtility[a7_0x515b4a(0x16c)]=ComputeRouteUtility[a7_0x515b4a(0x184)][a7_0x515b4a(0x16c)];